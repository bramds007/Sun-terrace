<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SunTerras — AMS (MVT direct)</title>
  <link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet" />
  <style>
    html,body{height:100%;margin:0;font-family:-apple-system,system-ui,Segoe UI,Roboto,sans-serif}
    header{padding:10px 12px;border-bottom:1px solid #eee;display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    #map{position:absolute;inset:66px 0 0 0}
    .badge{padding:4px 8px;border-radius:999px;background:#f5f5f5}
    #debug{position:absolute;top:70px;left:10px;z-index:9;background:#fff;padding:8px 10px;border:1px solid #eee;border-radius:8px;font:12px/1.3 -apple-system,system-ui}
    .controls{display:flex;gap:8px;align-items:center}
    .btn{padding:6px 10px;border:1px solid #ddd;border-radius:8px;background:#fff;cursor:pointer}
  </style>
</head>
<body>
<header>
  <strong>SunTerras — AMS</strong>
  <span class="badge">Bron: Gemeente Amsterdam MVT</span>
  <div class="controls">
    <button class="btn" id="zoomCentrum">Zoom Centrum</button>
    <button class="btn" id="zoomJaren">Café de Jaren</button>
    <button class="btn" id="zoomWaterkant">Waterkant</button>
  </div>
</header>

<div id="debug">
  <div><strong>Debug</strong></div>
  <div>Layers: <span id="dbg-layers">…</span></div>
  <div>Chosen layer: <span id="dbg-pick">…</span></div>
  <div>Visible features: <span id="dbg-vis">0</span></div>
</div>

<div id="map"></div>

<script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
<script>
const TILEJSON = 'https://api.data.amsterdam.nl/v1/mvt/horeca/tilejson.json';

// Bekende plekken
const P = {
  centrum: { lng: 4.8915, lat: 52.3700, z: 16 },                 // Dam/Rokin-gebied
  jaren:   { lng: 4.89463, lat: 52.36614, z: 17 },               // Café de Jaren
  water:   { lng: 4.88073, lat: 52.36754, z: 17 }                // Waterkant
};

const map = new maplibregl.Map({
  container:'map',
  style:{
    version:8,
    sources:{
      osm:{ type:'raster', tiles:['https://tile.openstreetmap.org/{z}/{x}/{y}.png'], tileSize:256, attribution:'© OpenStreetMap' },
      horeca:{ type:'vector', url: TILEJSON }
    },
    layers:[ { id:'osm', type:'raster', source:'osm' } ]
  },
  center:[P.centrum.lng, P.centrum.lat],
  zoom:P.centrum.z
});

map.on('load', async () => {
  // 1) Vind juiste layernaam uit tilejson
  let layers=[], pick=null;
  try{
    const tj = await fetch(TILEJSON).then(r=>r.json());
    layers = (tj.vector_layers||[]).map(v=>v.id);
    pick =
      layers.find(id => /terras/i.test(id)) ||
      layers.find(id => /exploit|vergunn/i.test(id)) ||
      layers[0];
  } catch(e) {
    layers=['(kon tilejson niet lezen)'];
  }
  document.getElementById('dbg-layers').textContent = layers.join(', ');
  document.getElementById('dbg-pick').textContent = pick || '(geen)';

  if(!pick) return;

  // 2) Teken ALLES uit de gekozen layer (geen filter; minzoom van tiles vereist vaak ver inzoomen)
  map.addLayer({
    id:'terr-fill',
    type:'fill',
    source:'horeca',
    'source-layer': pick,
    paint:{ 'fill-color':'#facc15', 'fill-opacity':0.55 }
  });
  map.addLayer({
    id:'terr-outline',
    type:'line',
    source:'horeca',
    'source-layer': pick,
    paint:{ 'line-color':'#111','line-width':1 }
  });
  map.addLayer({
    id:'terr-label',
    type:'symbol',
    source:'horeca',
    'source-layer': pick,
    layout:{
      'text-field': ['coalesce',['get','zaaknaam'],['get','naam'],['get','bedrijfsnaam'],['literal','Terras']],
      'text-size':11,'text-offset':[0,1.0],'text-anchor':'top'
    },
    paint:{ 'text-halo-color':'#fff','text-halo-width':1.2 }
  });

  // 3) Feature teller updaten na render of zoom
  function updateCount(){
    const n = map.queryRenderedFeatures({ layers:['terr-fill'] }).length;
    document.getElementById('dbg-vis').textContent = String(n);
  }
  map.on('idle', updateCount);
  map.on('moveend', updateCount);
  updateCount();

  // 4) Quick-zoom knoppen
  document.getElementById('zoomCentrum').onclick   = ()=> map.easeTo({ center:[P.centrum.lng,P.centrum.lat], zoom:P.centrum.z });
  document.getElementById('zoomJaren').onclick     = ()=> map.easeTo({ center:[P.jaren.lng,P.jaren.lat],   zoom:P.jaren.z });
  document.getElementById('zoomWaterkant').onclick = ()=> map.easeTo({ center:[P.water.lng,P.water.lat],   zoom:P.water.z });
});
  
</script>
</body>
</html>
